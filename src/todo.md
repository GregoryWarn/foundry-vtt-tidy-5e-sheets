## To Do

- [x] Refactor: make tag component reusable
- [ ] Container contained item description changes are not reactive on the container
  - Of note: the container is re-rendering. It's probably the item summary itself.
- [ ] Effect description changes are not reactive on the target item container
- [ ] Determine how unidentified should work
  - [ ] Item row
    - [ ] Item row text italicized, light grey, no background color
    - [ ] Item row image greyscale, opacity 75%
    - [ ] Item description uses unidentified description only
    - [ ] Charges hidden (emdash)
    - [ ] Price hidden (emdash)
  - [ ] All sheets
    - [ ] Image greyscale
    - [ ] Rarity color set to grey 40, rarity label readonly and set to "Unidentified" (all modes)
    - [ ] Cost label set to "?"
    - [ ] Charges hidden (emdash)
    - [ ] Use button greyed out, cannot be used
    - [ ] Details tab hidden until identified (all modes)
    - [ ] Activities tab hidden until identified (all modes)
    - [ ] Effects tab hidden until identified (all modes)
    - [ ] Name readonly "Unidentified <type>" (all modes)
    - [ ] Unidentified description expanded and editable
    - [ ] Description section hidden, Chat description section hidden
    - [ ] (Non-container sheets only) Sidebar sections all hidden except Sections section and pill switches
    - [ ] Header source label set to "?" if filled out, edit button hidden (all modes)
  - [ ] Non-container
- [ ] Notify Hightouch that spell sheet is ready for final review
- [ ] Test spell info on item summary and cards
- [ ] Begin thinking about how to extract common functionality across each table type (item, effects, activities)
- [ ] Propagate `sheet-header` class setup to all item sheets
- [ ] Review Container sheet to ensure it has everything
- [ ] Implement sheet header contents
  - [ ] Background
  - [ ] Class
    - [ ] header
      - [ ] Current level badge
    - [ ] Description tab
      - [ ] Description section header hidden, contents displayed
    - [ ] subtitle
      - [ ] Actor class level
  - [ ] Consumable
    - [ ] subtitle
      - [ ] Item Type
      - [ ] Item Subtype
    - [ ] summary
      - [ ] (when available) Charges
      - [ ] (when relevant) Cooldown
      - [ ] Price
      - [ ] Weight
      - [ ] Quantity
  - [x] Container
  - [ ] Equipment
    - [ ] subtitle
      - [ ] Type (Light Armor)
      - [ ] ## AC
    - [ ] summary
      - [ ] (when available) Charges
      - [ ] (when relevant) Cooldown
      - [ ] Price
      - [ ] Weight
      - [ ] Quantity
  - [ ] Facility
    - [ ] subtitle
      - [ ] Type
      - [ ] Order
    - [ ] summary
      - [ ] Progress (x / y)
      - [ ] Size
      - [ ] Cost (if not assigned)
  - [ ] Feat
    - [ ] subtitle
      - [ ] (When active) Activation Type (Action)
      - [ ] (When Active) Requirements (Paladin 2)
      - [ ] (When Passive)
    - [ ] summary 
      - [ ] (when available) Charges
      - [ ] (when relevant) Cooldown
  - [ ] Loot
    - [ ] Subtitle
      - [ ] Loot type
      - [ ] (if available) Loot subtype
    - [ ] summary
      - [ ] Price
      - [ ] Weight
      - [ ] Quantity
  - [ ] Species
  - [ ] Subclass
    - [ ] subtitle
  - [ ] Tool
    - [ ] subtitle
    - [ ] summary
      - [ ] (when available) Charges
      - [ ] (when relevant) Cooldown
      - [ ] Charges
      - [ ] Price
      - [ ] Weight
      - [ ] Quantity
  - [x] Weapon
    - [x] subtitle
    - [x] Summary
      - [x] (when available) Charges
      - [x] (when relevant) Cooldown
      - [x] Price
      - [x] Weight
      - [x] Quantity
- [ ] Finalize Description tab behavior for "text-based" sheets
  - [ ] Class / Subclass / Background / Species
    - [ ] Description tab
      - [ ] Description section header hidden, contents displayed
      - [ ] Edit mode always shows prosemirror visible in edit mode (like default sheets)
- [ ] Implement Activities tab
- [ ] Implement Effects tab
- [ ] Finish implementing container contents tab
- [ ] Implement Advancement tab
- [ ] Implement sidebar contents - prefer context data for pill groups with pill arrays of string and object (label / value)
  - [ ] Background
  - [ ] Class
  - [ ] Consumable
  - [ ] Container
  - [ ] Equipment
  - [ ] Facility
    - [ ] Category
    - [ ] Prerequisite
    - [ ] Y Hirelings
    - [ ] Y Defenders
    - [ ] Order
  - [ ] Feat
  - [ ] Loot
  - [ ] Species
  - [ ] Spell
    - Use the children snippet for spell-specific label-value pair info
  - [ ] Subclass
  - [ ] Tool
  - [ ] Weapon
  - [ ] Make sure Section section visible for all sheets
- [ ] Ensure Activities and Effects tabs include item counters in the title
  - [ ] This will need context-dependent tab titles, if they don't already exist
- [ ] https://discord.com/channels/@me/1243307347682529423/1336210686392668220
- [ ] Add context-dependent Tab visible / enabled predicate option to Tidy tabs, so that concealed content can entirely hide a tab, if needed
- [ ] Handle unidentified feature set
  - [ ] Portrait becomes washed over
  - [ ] Non-description tabs become disabled (preferably, hide them?)
- [ ] Wire up item-sheet-specific user sheet preferences for width and height. Look for other opportunities, also, like container toolbar.
- [ ] Replace rote individual span styles with util styles where able
- [ ] All section configs: pass in callback for preparing sections to view, so that we're not processing this during non-option-sheet renders. It should only render on option sheet prerender.
- [ ] Configure {TabId}: include a hook that allows people to pass in their own settings.
- [ ] SortingListbox - add touch support for drag and drop, if possible; and if it works out, remove the arrow buttons.
- [ ] Resolve TODO -  // TODO: Make this a callback to send through to the component for preparing sections properly
- [ ] Set up default/light/dark menu toggle and add to container
- [ ] Update sheet lock to work like the default sheets, including the additional render options and intuitive default state
- [ ] Item cards?
- [ ] add a class to section headers when there are no search results `.search-no-results`

### To Include on Actor Phase

- [ ] Effects tab
  - [ ] Info / Suppression UI https://discord.com/channels/@me/1243307347682529423/1351751313515479131
  - Repro: Put on a ring of protection but don't equip/attune to it.

### Stretch

- [ ] ButtonWithOptionsPanel - can the menu be outside the hidden window content and still anchor to the position of the menu? Very possible with a Portal. See https://svelte.dev/playground/8364bc976f0c4ff9b83adf6e7a3c19fd?version=5.22.5#H4sIAAAAAAAACp1V34-jNhD-V7zu6gJSBOqu1AcCOV3vpS-V-l6qrgNDcOPYlj1kN0L875VtCOQ2e7vaFwQzH9_8numpZEegGf1LGWSCrmnDBVia_d1TPGuncQK6nnDftE7sCQQ62Y5ZuCWvlESQaGlGc1sZrnFbyhL5USuDpCeVAYYQTJKBNEYdSUmTlFXIlbQl3Szg39VRKwkSZ9xFNJocfxCA5Kg6iVCTgjRMWNiUMk9nF2Ru8SzAe5MwrUnv3krcseqwN6qTdUYsAoid6GATdJrVNZf7jPz6m37xssE92ofp5yMzey5_1Cc6hDeCKiWUychzy_Ft4mtHdGe0gJlx1yEq-TOreXoJT-Y1P5FKMGuLkjKtS-qjztuH7Tet87R9CN8O1lnIljUp-lWj1Gq4_B9iGSkcyeM2IPO0fQw8ac1P3vDbnDtmPseJ_S-8mUo7jPi5L9KASXnjdfmYKCWzSvDqUPRRTIotiebeuBtf42FL-kn8law66T9WJCMr_zZ332ogeRqYty7TwTW6pggvSDM0HQzrN4Zm7OvkP3s9NFfyxdBcBgV5dZgHZNnsslLSIglJ_PfINCmIhGfyJ9NRvCklvHiKppPextXIRVLVsCbcZaKkNTSsE1jSOLRWID7AmRTk6f4-WEjue14PT2EuGxLNdpOW2egA5zgm2Br1TJ7qTgteMYTRO89VUs9Q0sABwsLC-cQCOpI1ca7FHmIAOyNJT2qwaNQ5W-JrEICQ7LisF76snamYDJtSDqW8xO4rOQbtAf0Uxt3P4ujkQapnOUVx3x_gPKYg5KhVFkmxdGsfwggBOHXCpQWDv0OjDIwuyE6IqxCjuNh6sGsBxqX1wJh8-eJNJAaO6gTfWy7qaMrP8LrE-gPFdStyzOfmw8W-maUwha5BozjBFmQUpmxcTyWOZkjxKv_jrhviuRXeAb_uhWBs_PyaRJeqf2wif7wg13N5Q_veSdPvHDOX-BMTHfiy_AFCqAC92Lr71BVzq7b_2D0RfN9ipQwTb92L8UI8bi9Ozbt4Ut9cxoudr68uyLb3QQ_zKl8s6hJzLnWHxI1xFrKTTufg80s8jIvf4cGZ1bDY3PNZub3D_xn-BxsHJbcUCQAA or obsidian dev vault
- [ ] Hightouch: If it's super simple (and only if it's super simple) it could be nice to hard link some of the currency/weight/item type directly to the fields (e.g. click it, opens the tab, focuses the input). But if it's not out-of-the-box it's not worth it. Just wasn't sure if it was actually possible

### To Do Graveyard

- [x] (Hightouch) Style Effects tab header buttons
- [x] (Hightouch) Rarity colors review
- [x] (Hightouch) Review Effects tab and apply any polish
- [x] Get Tidy tables working properly and looking nice with the latest styles
  - [x] New quantity control is wider than its 80px parent
  - [x] The table styles do not account for varying column widths and do not constrain child contents
  - [x] Item Name should truncate when too small
  - [x] Section header name should truncate when too small
  - [x] Tighten up actions column scaling for icons
  - [x] Add breakpoints for showing/hiding content, and add columns
    - [x] Charges : order to hide - 4
    - [x] Price : order to hide - 1
    ~~- [ ] Time : order to hide - 2~~
    - [x] Quantity : order to hide - 5
    - [x] Weight : order to hide - 3
  - [x] Finish creating quadrone-specific table components so that inline activities and item (document) summary can be owned by quadrone and classed accordingly.
- [x] Iterate on container tables
  - [x] Container expander to left, always visible. Item Desc / Activity expander on right, hidden until hovered, merely a visual indicator and not a separate clickable area, but always visible when expanded.
    - [x] Inline container contents
    - [x] Item Desc / Activities
  - [x] Add rarity colors to images
- [x] Add user preference sheet width memoization
~~- [ ] Expand/collapse All Sections is not working; fix it so container toggles work with it~~
- [x] Bug: On drop to container sheet, new item is counted but cannot appear until full refresh. Fix: Svelte update.
- [x] Implement filter menu / active button support
- [x] Implement sort button functionality and menu
  - [x] component
  - [x] context data for container
  - [x] sort logic for inventory items
  - [x] consolidate: put all sort-related content in a centralized location for sorting, similar to item filters (the runtime, the default filters, etc.)
  - [x] priority subtitle (include on model as `subtitle` and generically include, instead of using special treatment)
- [x] Implement section config / https://www.figma.com/design/seCsgsf8Uh82uxfPXIwFAg/Tidy5e-Sheet-Refresh?node-id=2182-75324&m=dev
  - [x] Migrate universal quadrone styles from items.scss to apps.scss so that items and options dialogs just work, given the right classes.
  - [x] Code up the section selection form and provide a means for passing in custom options.Depeneding on complexity of available options, consider making it data-driven.
    - [x] Display Options: Show container row (or equivalent preexisting loc key)
  - [x] Apply styles
  - [x] Clean up styles and organize
    - [x] Isolate listbox to its own component
    - [x] Make the options dialog styles specific to tab configuration with a TODO to share styles with other dialogs
- [x] Do DocumentSheet / prepareContext revisions to the core Svelte mixin so that it's more plug and play for all Tidy applications
- [x] Fix: Weightless container (Bag of Devouring) shows undefined in the Holds text
- [x] Sorting: Resolve todo - // TODO: This needs to be part of the sort group model, relating sort methods to specific groups.
- [x] (Hightouch) Complete dark mode for the container
- [x] Implement three dots onclick for container contents item rows
- [x] Inventory: Container inline capacity UI
  - Capacity column
  - For custom sections, let the columns be what they are, but let the container still do its same thing
  - [x] It's time to roll out per-section column specification
    - [x] Draft the proof of concept with Container Contents.
    - [x] Decide: Column spec in runtime, or in context prep? 
      - Leaning toward runtime, with the columns being pulled for use in the component where they are needed, to defer their processing to when their tab is pulled in. Propagating the columns through context is burdensome and far too distributed. Consolidating to a runtime file also makes it easier to manage settings, API callers, import/export, etc.
    - [x] ~~Explore: Can we toggle between Container columns and non-container columns, using a `condition` callback?~~ Using an override system with a fallback to the default column setup. API / World / Client / Sheet-flag settings will progressively override this.
  - [x] Properly pull column specs for each section in container contents
  - [x] Separate capacity bar and values into their own columns, favoring showing the bar when in small view.
    - [x] Both columns have no header content.
  - [x] Polish and finish capacity bar
- [x] Container: Image click behaviors
  - [x] Locked - Show preview
  - [x] Unlocked - File Picker
- [x] (Hightouch made first pass) Inventory: subtables have a different set of styles for their header
- [x] (Hightouch made first pass) Inventory: Inline container Empty styles
- [x] Implement spell sheet spell block in sidebar
- [x] Implement spell sheet header contents
  - [x] subtitle
    - [x] Level (1st Level)
    - [x] School
  - [x] summary
    - [x] (when available) Charges
    - [x] (when relevant) Cooldown
    - [x] linked item (Necklace of Fireballs)
  - [x] School Image across from title / subtitle
- [x] Implement Item Effects tab
  - [x] Populate with content and functionality
  - [x] Header create button
  - [x] Ctx menu
  - [x] Middle click to edit
  - [x] Make source label a hoverable item link
  - [x] Action buttons
    - [x] enable/disable - editable and not an enchantment
    - [x] edit, delete - unlocked
    - [x] three dots menu
  - [x] Purge all svelte-located SCSS in favor of global
- [x] Implement drag and drop activities
- [x] Implement drag and drop effects
- [x] Unidentified: add `unidentified` class to item table rows that are unidentified.
- [x] Experiment: ondblclick to edit a table row, instead of middle click
- [x] Port spell block to classic sheets and info cards
- [x] Implement Item Activities tab
  - [x] Populate with content and functionality
    - [x] Columns: (image) name, actions?
  - [x] Action buttons
  - [x] Ctx menu
  - [x] dbl click to edit
  - [x] Determine if there's any activity summary that can be shared. If so, shared it. Else, disable until dnd5e 5 / Foundry 13.